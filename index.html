<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LPK Tiers - Global Leaderboard</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root { --gold: #f5b942; --dark-bg: #0b1220; --card-bg: #141c2f; }
body { margin:0; font-family: Arial, sans-serif; background: var(--dark-bg); color:white; overflow-x: hidden; }
header { padding: 20px; font-size: 28px; font-weight: bold; text-align: center; }

/* Tabs Navigation */
.tabs { display: flex; gap: 10px; padding: 0 20px 20px; overflow-x: auto; white-space: nowrap; }
.tab { background: var(--card-bg); padding: 10px 15px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
.tab img { width: 20px; height: 20px; }
.tab.active { background: var(--gold); color: black; font-weight: bold; }

/* Leaderboard Player Row */
.container { padding: 10px; max-width: 1000px; margin: auto; }
.player { display: flex; align-items: center; background: var(--card-bg); margin-bottom: 12px; border-radius: 6px; overflow: hidden; height: 80px; position: relative; }
.rank-box { background: var(--gold); color: black; width: 60px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; font-style: italic; }

.content-area { display: flex; flex: 1; align-items: center; padding: 0 15px; gap: 15px; }
.skin { width: 45px; height: 45px; border-radius: 4px; background: #222; }
.info-text { flex: 1; min-width: 100px; }
.name-line { font-size: 18px; font-weight: bold; }
.title-line { font-size: 12px; color: var(--gold); opacity: 0.9; }

/* FIXED ICON ROW */
.tier-icons-row { display: flex; gap: 8px; align-items: center; margin-left: auto; }
.icon-unit { display: flex; flex-direction: column; align-items: center; width: 40px; }
.icon-unit img { width: 18px !important; height: 18px !important; object-fit: contain; }
.icon-unit span { font-size: 9px; margin-top: 2px; font-weight: bold; }

/* Admin UI */
.admin-login-btn { position: fixed; top: 20px; right: 20px; background: #3b82f6; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; z-index: 9999; }
.admin-panel { position: fixed; bottom: 20px; right: 20px; left: 20px; background: var(--card-bg); padding: 16px; border-radius: 14px; display: none; border: 2px solid var(--gold); z-index: 10000; }
input, select { padding: 10px; margin: 6px 0; border-radius: 8px; width: 100%; box-sizing: border-box; background: #0b1220; color: white; border: 1px solid #333; }
.btn-save { background: #4CAF50; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

<header>üèÜ LPK Tiers Leaderboard</header>
<button class="admin-login-btn" id="adminBtn">Admin</button>
<div class="tabs" id="tabs"></div>
<div class="container" id="leaderboard">Connecting to database...</div>

<div class="admin-panel" id="adminPanel">
    <div id="loginArea">
        <b>Admin Access</b>
        <input type="password" id="adminPassword" placeholder="Enter password">
        <button class="btn-save" onclick="login()">Login</button>
    </div>
    <div id="adminControls" style="display:none;">
        <b id="editingLabel">Editing Mode: Overall</b>
        <input id="targetName" placeholder="Minecraft Username">
        <select id="tierSelector">
            <option value="Unranked">Unranked (0)</option>
            <option value="HT1">HT1 (60)</option><option value="LT1">LT1 (45)</option>
            <option value="HT2">HT2 (30)</option><option value="LT2">LT2 (20)</option>
            <option value="HT3">HT3 (10)</option><option value="LT3">LT3 (6)</option>
            <option value="HT4">HT4 (4)</option><option value="LT4">LT4 (3)</option>
            <option value="HT5">HT5 (2)</option><option value="LT5">LT5 (1)</option>
        </select>
        <input id="manualPoints" type="number" placeholder="Bonus Points" style="display:none;">
        <button class="btn-save" onclick="updatePlayerData()">Save to Cloud</button>
    </div>
</div>

<script>
// 1. CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyDqCFNf8Y0373eYUr-Sexy4Qm91R_wv2lN",
  authDomain: "lpk-tiers.firebaseapp.com",
  databaseURL: "https://lpk-tiers-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "lpk-tiers",
  storageBucket: "lpk-tiers.firebasestorage.app",
  messagingSenderId: "1039213934246",
  appId: "1:1039213934246:web:ce4bd381d96154e4d56667"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const modesConfig = {
    "Overall": "https://minecraft.wiki/images/Nether_Star_JE3_BE2.png",
    "LTMs": "https://minecraft.wiki/images/Clock_JE3_BE3.gif",
    "Vanilla": "https://minecraft.wiki/images/Grass_Block_JE7_BE6.png",
    "UHC": "https://minecraft.wiki/images/Golden_Apple_JE2_BE2.png",
    "Pot": "https://minecraft.wiki/images/Splash_Potion_of_Healing_JE2_BE2.png",
    "NethOP": "https://minecraft.wiki/images/Netherite_Helmet_JE2_BE2.png", 
    "SMP": "https://minecraft.wiki/images/Iron_Pickaxe_JE3_BE2.png",
    "Sword": "https://minecraft.wiki/images/Diamond_Sword_JE3_BE3.png",
    "Axe": "https://minecraft.wiki/images/Netherite_Axe_JE2_BE2.png",
    "Mace": "https://minecraft.wiki/images/Mace_JE1_BE1.png"
};

const tierValues = { "HT1": 60, "LT1": 45, "HT2": 30, "LT2": 20, "HT3": 10, "LT3": 6, "HT4": 4, "LT4": 3, "HT5": 2, "LT5": 1, "Unranked": 0 };
let currentMode = "Overall";
let isAdmin = false;
let players = [];

// 2. FETCH DATA
db.ref("players").on("value", (snapshot) => {
    const data = snapshot.val();
    players = data ? Object.values(data) : [];
    renderPlayers();
}, (error) => {
    document.getElementById("leaderboard").innerText = "Error: " + error.message;
});

// 3. UI FUNCTIONS
function setMode(m) {
    currentMode = m;
    document.getElementById("editingLabel").innerText = "Editing: " + m;
    document.getElementById("tierSelector").style.display = (m === "Overall") ? "none" : "block";
    document.getElementById("manualPoints").style.display = (m === "Overall") ? "block" : "none";
    renderTabs();
    renderPlayers();
}

function renderTabs() {
    const tabs = document.getElementById("tabs");
    let html = "";
    for (const [name, icon] of Object.entries(modesConfig)) {
        html += `<div class="tab ${currentMode === name ? 'active' : ''}" onclick="setMode('${name}')">
            <img src="${icon}"> ${name}
        </div>`;
    }
    tabs.innerHTML = html;
}

function renderPlayers() {
    const board = document.getElementById("leaderboard");
    if (players.length === 0) {
        board.innerHTML = "<div style='text-align:center; padding:40px; opacity:0.5;'>No players found in database.</div>";
        return;
    }

    const sorted = [...players].sort((a,b) => (b.scores[currentMode] || 0) - (a.scores[currentMode] || 0));
    board.innerHTML = "";

    sorted.forEach((p, i) => {
        const pts = p.scores[currentMode] || 0;
        let title = "Combatant";
        if (pts >= 400) title = "Combat Grandmaster";
        else if (pts >= 200) title = "Combat Master";
        else if (pts >= 60) title = "Combat Expert";

        let sideContent = "";
        if (currentMode === "Overall") {
            sideContent = `<div class="tier-icons-row">`;
            for (const [m, img] of Object.entries(modesConfig)) {
                if (m === "Overall") continue;
                const t = p.tiers[m] || 'Unranked';
                const color = (t !== 'Unranked') ? 'var(--gold)' : '#555';
                sideContent += `<div class="icon-unit">
                    <img src="${img}">
                    <span style="color:${color}">${t.replace('Unranked','UR')}</span>
                </div>`;
            }
            sideContent += `</div>`;
        } else {
            sideContent = `<b style="color:var(--gold); font-size:20px;">${p.tiers[currentMode] || 'Unranked'}</b>`;
        }

        const div = document.createElement("div");
        div.className = "player";
        div.innerHTML = `
            <div class="rank-box">${i+1}</div>
            <div class="content-area">
                <img class="skin" src="https://mc-heads.net/avatar/${p.name}">
                <div class="info-text">
                    <div class="name-line">${p.name}</div>
                    <div class="title-line">${title} (${pts} pts)</div>
                </div>
                ${sideContent}
                ${isAdmin ? `<button onclick="removePlayer('${p.name}')" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:4px; margin-left:10px; cursor:pointer;">√ó</button>` : ''}
            </div>`;
        board.appendChild(div);
    });
}

function login() {
    const pass = document.getElementById("adminPassword").value;
    if(pass === "DeepWoken#") {
        isAdmin = true;
        document.getElementById("loginArea").style.display = "none";
        document.getElementById("adminControls").style.display = "block";
        renderPlayers();
    } else { alert("Wrong Password"); }
}

function updatePlayerData() {
    const name = document.getElementById("targetName").value.trim();
    if(!name) return;
    
    let p = players.find(x => x.name.toLowerCase() === name.toLowerCase());
    if(!p) {
        p = { name: name, tiers: {}, scores: {}, bonus: 0 };
        for (const m in modesConfig) { p.tiers[m] = "Unranked"; p.scores[m] = 0; }
    }
    
    if (currentMode === "Overall") {
        p.bonus = (p.bonus || 0) + (parseInt(document.getElementById("manualPoints").value) || 0);
    } else {
        const t = document.getElementById("tierSelector").value;
        p.tiers[currentMode] = t;
        p.scores[currentMode] = tierValues[t] || 0;
    }
    
    let total = p.bonus || 0;
    for (const m in modesConfig) { if(m !== "Overall") total += (tierValues[p.tiers[m]] || 0); }
    p.scores["Overall"] = total;

    db.ref("players/" + name.replace(/\./g, '_')).set(p).then(() => {
        document.getElementById("targetName").value = "";
        document.getElementById("manualPoints").value = "";
    });
}

function removePlayer(name) { if(confirm("Delete " + name + "?")) db.ref("players/" + name.replace(/\./g, '_')).remove(); }
document.getElementById("adminBtn").onclick = () => {
    const p = document.getElementById("adminPanel");
    p.style.display = (p.style.display === "block") ? "none" : "block";
};
window.onload = () => { renderTabs(); };
</script>
</body>
</html>
